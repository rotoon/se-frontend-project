# เอกสารการออกแบบระบบ

## ภาพรวม

ระบบหน้า admin สำหรับจัดการสถานที่ท่องเที่ยวเชียงใหม่ เป็นเว็บแอปพลิเคชันที่พัฒนาด้วย HTML, CSS, Bootstrap และ Express.js โดยใช้ไฟล์ JSON เป็นที่เก็บข้อมูล ระบบจะมีหน้าเว็บสำหรับผู้ดูแลระบบในการจัดการข้อมูลสถานที่ท่องเที่ยวต่างๆ ในจังหวัดเชียงใหม่ รองรับการจัดการข้อมูลหลากหลายประเภท เช่น ร้านอาหาร ที่พัก สถานที่ท่องเที่ยว กิจกรรม และบริการต่างๆ พร้อมรองรับการแสดงผลข้อมูลในหลายภาษา (ไทย อังกฤษ จีน และญี่ปุ่น)

## สถาปัตยกรรม

### โครงสร้างโปรเจค
```
chiang-mai-admin/
├── server.js                 # Express.js server หลัก
├── package.json              # Dependencies และ scripts
├── data/
│   ├── places.json          # ข้อมูลสถานที่ท่องเที่ยว
│   ├── categories.json      # ข้อมูลหมวดหมู่
│   ├── users.json           # ข้อมูลผู้ใช้ admin
│   └── backups/             # โฟลเดอร์สำรองข้อมูล
├── public/
│   ├── css/
│   │   └── admin.css        # CSS สำหรับหน้า admin
│   ├── js/
│   │   └── admin.js         # JavaScript สำหรับหน้า admin
│   └── uploads/             # รูปภาพที่อัปโหลด
├── views/
│   ├── login.html           # หน้าเข้าสู่ระบบ
│   ├── dashboard.html       # หน้าแดชบอร์ด
│   ├── places-list.html     # หน้ารายการสถานที่
│   ├── place-form.html      # หน้าฟอร์มเพิ่ม/แก้ไขสถานที่
│   └── categories.html      # หน้าจัดการหมวดหมู่
└── routes/
    ├── auth.js              # Routes สำหรับการเข้าสู่ระบบ
    ├── places.js            # Routes สำหรับจัดการสถานที่
    └── categories.js        # Routes สำหรับจัดการหมวดหมู่
```

### เทคโนโลยีที่ใช้
- **Backend:** Node.js + Express.js
- **Frontend:** HTML5, CSS3, Bootstrap 5
- **Database:** JSON Files
- **Session Management:** express-session
- **File Upload:** multer
- **Authentication:** bcrypt สำหรับ password hashing
## ค
อมโพเนนต์และอินเทอร์เฟซ

### 1. ระบบการเข้าสู่ระบบ (Authentication)
- **หน้าเข้าสู่ระบบ:** ฟอร์มสำหรับกรอก username/password
- **Session Management:** ใช้ express-session เก็บสถานะการเข้าสู่ระบบ พร้อมการกำหนดเวลาหมดอายุ
- **Middleware:** ตรวจสอบการเข้าสู่ระบบก่อนเข้าถึงหน้า admin
- **ระบบป้องกัน Brute Force:** จำกัดการพยายามเข้าสู่ระบบสูงสุด 5 ครั้ง และล็อคบัญชีชั่วคราว 15 นาที
- **การบันทึกประวัติ:** เก็บบันทึกการเข้าสู่ระบบพร้อมวันที่และเวลา
- **การออกจากระบบ:** ล้างเซสชันและเปลี่ยนเส้นทางไปยังหน้าเข้าสู่ระบบ

### 2. หน้าแดชบอร์ด (Dashboard)
- **สถิติรวม:** จำนวนสถานที่ทั้งหมด, จำนวนตามหมวดหมู่, สถานที่ใหม่
- **การนำทาง:** เมนูไปยังหน้าต่างๆ
- **ข้อมูลผู้ใช้:** แสดงชื่อผู้ใช้และปุ่มออกจากระบบ

### 3. หน้ารายการสถานที่ (Places List)
- **ตารางแสดงข้อมูล:** รายการสถานที่พร้อมข้อมูลสำคัญ
- **ระบบค้นหา:** ช่องค้นหาตามชื่อหรือคำสำคัญ
- **ระบบกรอง:** กรองตามหมวดหมู่และสถานะ
- **การแบ่งหน้า:** Pagination สำหรับข้อมูลจำนวนมาก
- **ปุ่มจัดการ:** แก้ไข, ลบ, เปลี่ยนสถานะ

### 4. หน้าฟอร์มสถานที่ (Place Form)
- **แท็บหลายภาษา:** ไทย, อังกฤษ, จีน, ญี่ปุ่น (ภาษาไทยเป็นภาษาหลักที่จำเป็น)
- **ฟิลด์ข้อมูลหลัก:** ชื่อ, คำอธิบาย, หมวดหมู่, เวลาทำการ, ช่วงราคา
- **ฟิลด์ติดต่อ:** ที่อยู่, โทรศัพท์, เว็บไซต์, Facebook, Instagram
- **การจัดการรูปภาพ:** อัปโหลด (JPG, PNG, WebP สูงสุด 5MB), จัดเรียง, ตั้งรูปเด่น, ลบ
- **การตรวจสอบข้อมูล:** ตรวจสอบรูปแบบโทรศัพท์ไทย, URL, พิกัดตำแหน่ง, ลิงก์โซเชียลมีเดีย
- **แผนที่:** แสดงตำแหน่งจากพิกัด GPS พร้อมตัวอย่าง
- **การจัดการสถานะ:** ร่าง, เผยแพร่, ไม่ใช้งาน, เด่น

### 5. หน้าจัดการหมวดหมู่ (Categories)
- **รายการหมวดหมู่:** แสดงหมวดหมู่พร้อมจำนวนสถานที่
- **เพิ่ม/แก้ไข/ลบ:** จัดการหมวดหมู่
- **การเรียงลำดับ:** จัดเรียงหมวดหมู่## โม
เดลข้อมูล

### 1. Place (สถานที่)
```json
{
  "id": "string (UUID)",
  "name": {
    "th": "string",
    "en": "string",
    "zh": "string",
    "ja": "string"
  },
  "description": {
    "th": "string",
    "en": "string",
    "zh": "string",
    "ja": "string"
  },
  "category": "string (category ID)",
  "images": [
    {
      "filename": "string",
      "alt": "string",
      "featured": "boolean"
    }
  ],
  "contact": {
    "address": "string",
    "phone": "string",
    "website": "string",
    "facebook": "string",
    "instagram": "string",
    "coordinates": {
      "lat": "number",
      "lng": "number"
    }
  },
  "hours": "string",
  "priceRange": "string",
  "status": "string (draft|published|inactive)",
  "featured": "boolean",
  "createdAt": "datetime",
  "updatedAt": "datetime",
  "createdBy": "string (user ID)"
}
```

### 2. Category (หมวดหมู่)
```json
{
  "id": "string (UUID)",
  "name": {
    "th": "string",
    "en": "string",
    "zh": "string",
    "ja": "string"
  },
  "slug": "string",
  "icon": "string",
  "order": "number",
  "createdAt": "datetime"
}
```

### 3. User (ผู้ใช้)
```json
{
  "id": "string (UUID)",
  "username": "string",
  "password": "string (hashed)",
  "email": "string",
  "role": "string (admin)",
  "loginAttempts": "number",
  "lockUntil": "datetime",
  "lastLogin": "datetime",
  "createdAt": "datetime"
}
```
## การตัดสินใจออกแบบและเหตุผล

### 1. การใช้ไฟล์ JSON แทนฐานข้อมูล
**เหตุผล:** เพื่อความง่ายในการจัดการและไม่ต้องการติดตั้งระบบฐานข้อมูลเพิ่มเติม เหมาะสำหรับข้อมูลขนาดกลางและการพัฒนาที่รวดเร็ว

### 2. การรองรับ 4 ภาษา (ไทย อังกฤษ จีน ญี่ปุ่น)
**เหตุผล:** เชียงใหม่เป็นจุดหมายท่องเที่ยวนานาชาติ โดยเฉพาะนักท่องเที่ยวจากจีนและญี่ปุ่น การรองรับหลายภาษาจะเพิ่มการเข้าถึงข้อมูล

### 3. ระบบสำรองข้อมูลอัตโนมัติ
**เหตุผล:** เนื่องจากใช้ไฟล์ JSON การสำรองข้อมูลก่อนการแก้ไขทุกครั้งจะป้องกันการสูญหายของข้อมูลจากข้อผิดพลาด

### 4. การจำกัดการพยายามเข้าสู่ระบบ
**เหตุผล:** ป้องกันการโจมตี brute force และเพิ่มความปลอดภัยของระบบ admin

### 5. การจัดการสถานะสถานที่หลายระดับ
**เหตุผล:** ให้ความยืดหยุนในการควบคุมเนื้อหาที่เผยแพร่ สามารถจัดการร่าง เผยแพร่ และเด่นได้ตามต้องการ

## การจัดการข้อผิดพลาด

### 1. การตรวจสอบข้อมูล (Validation)
- **Frontend Validation:** ใช้ HTML5 validation และ JavaScript
- **Backend Validation:** ตรวจสอบข้อมูลก่อนบันทึกลงไฟล์
- **ข้อความแสดงข้อผิดพลาด:** แสดงข้อความเป็นภาษาไทยที่เข้าใจง่าย

### 2. การจัดการไฟล์ JSON
- **การสำรองข้อมูล:** สำรองไฟล์ JSON ก่อนการแก้ไขทุกครั้งในโฟลเดอร์ backups/
- **การตรวจสอบไฟล์:** ตรวจสอบความถูกต้องของ JSON structure ก่อนบันทึก
- **การกู้คืนข้อมูล:** กลไกสำหรับกู้คืนจากไฟล์สำรอง
- **การสร้างไฟล์ใหม่:** สร้างไฟล์ JSON ใหม่พร้อมข้อมูลเริ่มต้นหากไฟล์เสียหาย
- **การอัปเดตทันที:** อัปเดตไฟล์ JSON ทันทีเมื่อมีการเปลี่ยนแปลงข้อมูล
- **การจัดการข้อผิดพลาด:** แสดงข้อความแสดงข้อผิดพลาดที่ชัดเจนเมื่อมีปัญหาการอ่าน/เขียนไฟล์

### 3. การจัดการรูปภาพ
- **การตรวจสอบไฟล์:** ตรวจสอบประเภทไฟล์ (JPG, PNG, WebP) และขนาดไฟล์ (สูงสุด 5MB ต่อรูป)
- **การจัดการหลายรูป:** รองรับการอัปโหลดหลายรูปพร้อมการจัดเรียงใหม่
- **การตั้งรูปเด่น:** ระบบทำเครื่องหมายรูปภาพแสดงหลัก
- **การจัดการข้อผิดพลาด:** แสดงข้อความเฉพาะเมื่ออัปโหลดล้มเหลว
- **การลบไฟล์:** ลบไฟล์รูปภาพและอัปเดตฐานข้อมูลเมื่อลบข้อมูลสถานที่

### 4. การจัดการเซสชัน
- **Session Timeout:** กำหนดเวลาหมดอายุเซสชัน
- **การตรวจสอบสิทธิ์:** ตรวจสอบสิทธิ์ก่อนเข้าถึงทุกหน้า
- **การออกจากระบบ:** ล้างเซสชันเมื่อออกจากระบบ

## กลยุทธ์การทดสอบ

### 1. การทดสอบ Frontend
- **การทดสอบฟอร์ม:** ทดสอบการกรอกข้อมูลและ validation รวมถึงการตรวจสอบรูปแบบข้อมูล
- **การทดสอบ UI:** ทดสอบการแสดงผลในเบราว์เซอร์ต่างๆ
- **การทดสอบ Responsive:** ทดสอบการแสดงผลในหน้าจอขนาดต่างๆ
- **การทดสอบหลายภาษา:** ทดสอบการสลับภาษาและการแสดงผลเนื้อหาหลายภาษา
- **การทดสอบการอัปโหลดรูปภาพ:** ทดสอบการอัปโหลด จัดเรียง และลบรูปภาพ

### 2. การทดสอบ Backend
- **การทดสอบ API:** ทดสอบ endpoints ต่างๆ รวมถึงการจัดการข้อผิดพลาด
- **การทดสอบการจัดการไฟล์ JSON:** ทดสอบการอ่าน/เขียน/สำรองไฟล์ JSON
- **การทดสอบ Authentication:** ทดสอบระบบเข้าสู่ระบบ รวมถึงการป้องกัน brute force
- **การทดสอบ Validation:** ทดสอบการตรวจสอบข้อมูลทั้งหมด (โทรศัพท์, URL, พิกัด)
- **การทดสอบการจัดการสถานะ:** ทดสอบการเปลี่ยนสถานะสถานที่และการมองเห็น

### 3. การทดสอบ Integration
- **การทดสอบ End-to-End:** ทดสอบการทำงานของระบบทั้งหมดตั้งแต่เข้าสู่ระบบจนถึงการจัดการข้อมูل
- **การทดสอบการอัปโหลดไฟล์:** ทดสอบการอัปโหลดรูปภาพหลายรูปและการจัดการ
- **การทดสอบการสำรองข้อมูล:** ทดสอบระบบสำรองและกู้คืนข้อมูล JSON
- **การทดสอบการจัดการหมวดหมู่:** ทดสอบการเพิ่ม แก้ไข ลบหมวดหมู่และผลกระทบต่อสถานที่