<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายการสถานที่ - ระบบจัดการสถานที่ท่องเที่ยวเชียงใหม่</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts - Sarabun -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/dashboard">
                <i class="fas fa-map-marked-alt me-2"></i>
                เชียงใหม่ Admin
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">
                            <i class="fas fa-tachometer-alt me-1"></i>
                            แดชบอร์ด
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/places">
                            <i class="fas fa-map-marker-alt me-1"></i>
                            จัดการสถานที่
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/categories">
                            <i class="fas fa-tags me-1"></i>
                            จัดการหมวดหมู่
                        </a>
                    </li>
                </ul>
                
                <!-- User Info and Logout -->
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <span id="username-display">ผู้ดูแลระบบ</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <span class="dropdown-item-text">
                                    <small class="text-muted">เข้าสู่ระบบล่าสุด:</small><br>
                                    <span id="last-login-display">-</span>
                                </span>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="#" onclick="logout()">
                                    <i class="fas fa-sign-out-alt me-1"></i>
                                    ออกจากระบบ
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-md-6">
                <h1 class="h3 mb-0">รายการสถานที่</h1>
                <p class="text-muted">จัดการข้อมูลสถานที่ท่องเที่ยวทั้งหมด</p>
            </div>
            <div class="col-md-6 text-end">
                <a href="/places/new" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>
                    เพิ่มสถานที่ใหม่
                </a>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">ค้นหาและกรองข้อมูล</h6>
            </div>
            <div class="card-body">
                <form id="search-filter-form">
                    <div class="row">
                        <!-- Search Input -->
                        <div class="col-md-4 mb-3">
                            <label for="search-input" class="form-label">ค้นหา</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control" id="search-input" 
                                       placeholder="ค้นหาตามชื่อหรือคำสำคัญ...">
                            </div>
                        </div>
                        
                        <!-- Category Filter -->
                        <div class="col-md-3 mb-3">
                            <label for="category-filter" class="form-label">หมวดหมู่</label>
                            <select class="form-select" id="category-filter">
                                <option value="">ทุกหมวดหมู่</option>
                                <!-- Categories will be loaded dynamically -->
                            </select>
                        </div>
                        
                        <!-- Status Filter -->
                        <div class="col-md-3 mb-3">
                            <label for="status-filter" class="form-label">สถานะ</label>
                            <select class="form-select" id="status-filter">
                                <option value="">ทุกสถานะ</option>
                                <option value="draft">ร่าง</option>
                                <option value="published">เผยแพร่</option>
                                <option value="inactive">ไม่ใช้งาน</option>
                            </select>
                        </div>
                        
                        <!-- Filter Actions -->
                        <div class="col-md-2 mb-3">
                            <label class="form-label">&nbsp;</label>
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-outline-secondary" onclick="clearFilters()">
                                    <i class="fas fa-times me-1"></i>
                                    ล้าง
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Places Table -->
        <div class="card shadow">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">รายการสถานที่</h6>
                <div class="d-flex align-items-center">
                    <span class="text-muted me-3" id="results-count">กำลังโหลด...</span>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshPlaces()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <!-- Loading State -->
                <div id="loading-state" class="text-center py-5">
                    <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                    <p class="text-muted mt-2">กำลังโหลดข้อมูล...</p>
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="text-center py-5" style="display: none;">
                    <i class="fas fa-map-marker-alt fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">ไม่พบสถานที่</h5>
                    <p class="text-muted">ยังไม่มีสถานที่ในระบบ หรือไม่พบผลลัพธ์ที่ตรงกับการค้นหา</p>
                    <a href="/places/new" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>
                        เพิ่มสถานที่แรก
                    </a>
                </div>

                <!-- Places Table -->
                <div id="places-table-container" style="display: none;">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th width="5%">#</th>
                                    <th width="15%">รูปภาพ</th>
                                    <th width="25%">ชื่อสถานที่</th>
                                    <th width="15%">หมวดหมู่</th>
                                    <th width="10%">สถานะ</th>
                                    <th width="15%">วันที่สร้าง</th>
                                    <th width="15%">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="places-table-body">
                                <!-- Places will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <nav aria-label="Places pagination" id="pagination-container">
                        <ul class="pagination justify-content-center" id="pagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">ยืนยันการลบ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>คุณต้องการลบสถานที่ <strong id="delete-place-name"></strong> หรือไม่?</p>
                    <p class="text-danger small">
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        การดำเนินการนี้ไม่สามารถยกเลิกได้
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn">
                        <i class="fas fa-trash me-1"></i>
                        ลบสถานที่
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="/js/admin.js"></script>
    
    <!-- Places List specific JS -->
    <script>
        // Global variables
        let currentPage = 1;
        let itemsPerPage = 10;
        let totalItems = 0;
        let allPlaces = [];
        let filteredPlaces = [];
        let categories = [];
        let deleteModal;
        let currentDeleteId = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initPlacesList();
        });

        function initPlacesList() {
            deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            loadUserInfo();
            loadCategories();
            loadPlaces();
            setupEventListeners();
        }

        function setupEventListeners() {
            // Search input
            document.getElementById('search-input').addEventListener('input', debounce(filterPlaces, 300));
            
            // Filter selects
            document.getElementById('category-filter').addEventListener('change', filterPlaces);
            document.getElementById('status-filter').addEventListener('change', filterPlaces);
            
            // Delete confirmation
            document.getElementById('confirm-delete-btn').addEventListener('click', confirmDelete);
        }

        function loadUserInfo() {
            fetch('/api/user/info')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('username-display').textContent = data.user.username;
                        if (data.user.lastLogin) {
                            const lastLogin = new Date(data.user.lastLogin);
                            document.getElementById('last-login-display').textContent = 
                                lastLogin.toLocaleString('th-TH');
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading user info:', error);
                });
        }

        function loadCategories() {
            fetch('/api/categories')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        categories = data.categories;
                        populateCategoryFilter();
                    }
                })
                .catch(error => {
                    console.error('Error loading categories:', error);
                });
        }

        function populateCategoryFilter() {
            const categoryFilter = document.getElementById('category-filter');
            const currentValue = categoryFilter.value;
            
            // Clear existing options except "ทุกหมวดหมู่"
            categoryFilter.innerHTML = '<option value="">ทุกหมวดหมู่</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name.th;
                categoryFilter.appendChild(option);
            });
            
            // Restore previous selection
            categoryFilter.value = currentValue;
        }

        function loadPlaces() {
            showLoading();
            
            fetch('/api/places')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        allPlaces = data.places;
                        filterPlaces();
                    } else {
                        showError('เกิดข้อผิดพลาดในการโหลดข้อมูลสถานที่');
                    }
                })
                .catch(error => {
                    console.error('Error loading places:', error);
                    showError('เกิดข้อผิดพลาดในการเชื่อมต่อกับเซิร์ฟเวอร์');
                });
        }

        function filterPlaces() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            const statusFilter = document.getElementById('status-filter').value;

            filteredPlaces = allPlaces.filter(place => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    place.name.th.toLowerCase().includes(searchTerm) ||
                    place.name.en.toLowerCase().includes(searchTerm) ||
                    (place.description.th && place.description.th.toLowerCase().includes(searchTerm)) ||
                    (place.description.en && place.description.en.toLowerCase().includes(searchTerm));

                // Category filter
                const matchesCategory = !categoryFilter || place.category === categoryFilter;

                // Status filter
                const matchesStatus = !statusFilter || place.status === statusFilter;

                return matchesSearch && matchesCategory && matchesStatus;
            });

            totalItems = filteredPlaces.length;
            currentPage = 1; // Reset to first page when filtering
            displayPlaces();
            updateResultsCount();
        }

        function displayPlaces() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const placesToShow = filteredPlaces.slice(startIndex, endIndex);

            if (filteredPlaces.length === 0) {
                showEmptyState();
                return;
            }

            showPlacesTable();
            renderPlacesTable(placesToShow, startIndex);
            renderPagination();
        }

        function renderPlacesTable(places, startIndex) {
            const tbody = document.getElementById('places-table-body');
            tbody.innerHTML = '';

            places.forEach((place, index) => {
                const row = createPlaceRow(place, startIndex + index + 1);
                tbody.appendChild(row);
            });

            // Initialize tooltips for the newly created buttons
            initializeTooltips();
        }

        function createPlaceRow(place, rowNumber) {
            const tr = document.createElement('tr');
            
            // Get category name
            const category = categories.find(cat => cat.id === place.category);
            const categoryName = category ? category.name.th : 'ไม่ระบุ';
            
            // Format date
            const createdDate = new Date(place.createdAt).toLocaleDateString('th-TH');
            
            // Get featured image
            const featuredImage = place.images && place.images.length > 0 
                ? place.images.find(img => img.featured) || place.images[0]
                : null;

            tr.innerHTML = `
                <td>${rowNumber}</td>
                <td>
                    ${featuredImage 
                        ? `<img src="/uploads/${featuredImage.filename}" alt="${place.name.th}" 
                             class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;">`
                        : `<div class="bg-light d-flex align-items-center justify-content-center" 
                             style="width: 60px; height: 60px; border-radius: 0.375rem;">
                             <i class="fas fa-image text-muted"></i>
                           </div>`
                    }
                </td>
                <td>
                    <div>
                        <strong>${place.name.th}</strong>
                        ${place.name.en ? `<br><small class="text-muted">${place.name.en}</small>` : ''}
                    </div>
                </td>
                <td>
                    <span class="badge bg-secondary">
                        <i class="fas fa-${category ? category.icon : 'tag'} me-1"></i>
                        ${categoryName}
                    </span>
                </td>
                <td>${getStatusBadge(place.status)}</td>
                <td>${createdDate}</td>
                <td>
                    <div class="btn-group" role="group" aria-label="การจัดการสถานที่">
                        <a href="/places/${place.id}" class="btn btn-sm btn-outline-primary" title="ดูรายละเอียด" data-bs-toggle="tooltip">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="/places/${place.id}/edit" class="btn btn-sm btn-outline-warning" title="แก้ไข" data-bs-toggle="tooltip">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button type="button" class="btn btn-sm btn-outline-success" 
                                onclick="toggleStatus('${place.id}', '${place.status}')" 
                                title="${place.status === 'published' ? 'เปลี่ยนเป็นไม่ใช้งาน' : 'เปลี่ยนเป็นเผยแพร่'}" 
                                data-bs-toggle="tooltip">
                            <i class="fas fa-toggle-${place.status === 'published' ? 'on' : 'off'}"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                onclick="showDeleteModal('${place.id}', '${place.name.th}')" 
                                title="ลบสถานที่" 
                                data-bs-toggle="tooltip">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;

            return tr;
        }

        function getStatusBadge(status) {
            const statusConfig = {
                'draft': { class: 'bg-secondary', text: 'ร่าง', icon: 'file-alt' },
                'published': { class: 'bg-success', text: 'เผยแพร่', icon: 'eye' },
                'inactive': { class: 'bg-danger', text: 'ไม่ใช้งาน', icon: 'eye-slash' }
            };

            const config = statusConfig[status] || statusConfig['draft'];
            return `<span class="badge ${config.class}">
                        <i class="fas fa-${config.icon} me-1"></i>
                        ${config.text}
                    </span>`;
        }

        function renderPagination() {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            if (totalPages <= 1) {
                document.getElementById('pagination-container').style.display = 'none';
                return;
            }

            document.getElementById('pagination-container').style.display = 'block';

            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1})">ก่อนหน้า</a>`;
            pagination.appendChild(prevLi);

            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                const firstLi = document.createElement('li');
                firstLi.className = 'page-item';
                firstLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(1)">1</a>`;
                pagination.appendChild(firstLi);

                if (startPage > 2) {
                    const ellipsisLi = document.createElement('li');
                    ellipsisLi.className = 'page-item disabled';
                    ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
                    pagination.appendChild(ellipsisLi);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
                pagination.appendChild(li);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsisLi = document.createElement('li');
                    ellipsisLi.className = 'page-item disabled';
                    ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
                    pagination.appendChild(ellipsisLi);
                }

                const lastLi = document.createElement('li');
                lastLi.className = 'page-item';
                lastLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${totalPages})">${totalPages}</a>`;
                pagination.appendChild(lastLi);
            }

            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1})">ถัดไป</a>`;
            pagination.appendChild(nextLi);
        }

        function changePage(page) {
            if (page < 1 || page > Math.ceil(totalItems / itemsPerPage)) return;
            currentPage = page;
            displayPlaces();
        }

        function updateResultsCount() {
            const resultsCount = document.getElementById('results-count');
            if (totalItems === 0) {
                resultsCount.textContent = 'ไม่พบผลลัพธ์';
            } else {
                const startItem = (currentPage - 1) * itemsPerPage + 1;
                const endItem = Math.min(currentPage * itemsPerPage, totalItems);
                resultsCount.textContent = `แสดง ${startItem}-${endItem} จาก ${totalItems} รายการ`;
            }
        }

        function showLoading() {
            document.getElementById('loading-state').style.display = 'block';
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('places-table-container').style.display = 'none';
        }

        function showEmptyState() {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('empty-state').style.display = 'block';
            document.getElementById('places-table-container').style.display = 'none';
        }

        function showPlacesTable() {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('places-table-container').style.display = 'block';
        }

        function showError(message) {
            document.getElementById('loading-state').innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-exclamation-triangle fa-2x text-danger mb-3"></i>
                    <h5 class="text-danger">เกิดข้อผิดพลาด</h5>
                    <p class="text-muted">${message}</p>
                    <button class="btn btn-primary" onclick="loadPlaces()">
                        <i class="fas fa-sync-alt me-1"></i>
                        ลองใหม่
                    </button>
                </div>
            `;
        }

        function clearFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('category-filter').value = '';
            document.getElementById('status-filter').value = '';
            filterPlaces();
        }

        function refreshPlaces() {
            loadPlaces();
        }

        function showDeleteModal(placeId, placeName) {
            currentDeleteId = placeId;
            document.getElementById('delete-place-name').textContent = placeName;
            deleteModal.show();
        }

        function confirmDelete() {
            if (!currentDeleteId) return;

            const confirmBtn = document.getElementById('confirm-delete-btn');
            const originalText = confirmBtn.innerHTML;
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>กำลังลบ...';
            confirmBtn.disabled = true;

            fetch(`/api/places/${currentDeleteId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    deleteModal.hide();
                    showAlert('ลบสถานที่เรียบร้อยแล้ว', 'success');
                    loadPlaces();
                } else {
                    showAlert(data.message || 'เกิดข้อผิดพลาดในการลบสถานที่', 'danger');
                }
            })
            .catch(error => {
                console.error('Error deleting place:', error);
                showAlert('เกิดข้อผิดพลาดในการเชื่อมต่อกับเซิร์ฟเวอร์', 'danger');
            })
            .finally(() => {
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
                currentDeleteId = null;
            });
        }

        function toggleStatus(placeId, currentStatus) {
            const newStatus = currentStatus === 'published' ? 'inactive' : 'published';
            const statusText = newStatus === 'published' ? 'เผยแพร่' : 'ไม่ใช้งาน';
            
            // Find the button and show loading state
            const button = document.querySelector(`button[onclick*="${placeId}"][onclick*="toggleStatus"]`);
            if (button) {
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                button.disabled = true;
                
                fetch(`/api/places/${placeId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showAlert(`เปลี่ยนสถานะเป็น${statusText}แล้ว`, 'success');
                        loadPlaces();
                    } else {
                        showAlert(data.message || 'เกิดข้อผิดพลาดในการเปลี่ยนสถานะ', 'danger');
                        // Restore button state on error
                        button.innerHTML = originalHTML;
                        button.disabled = false;
                    }
                })
                .catch(error => {
                    console.error('Error toggling status:', error);
                    showAlert('เกิดข้อผิดพลาดในการเชื่อมต่อกับเซิร์ฟเวอร์', 'danger');
                    // Restore button state on error
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                });
            } else {
                // Fallback if button not found
                fetch(`/api/places/${placeId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showAlert(`เปลี่ยนสถานะเป็น${statusText}แล้ว`, 'success');
                        loadPlaces();
                    } else {
                        showAlert(data.message || 'เกิดข้อผิดพลาดในการเปลี่ยนสถานะ', 'danger');
                    }
                })
                .catch(error => {
                    console.error('Error toggling status:', error);
                    showAlert('เกิดข้อผิดพลาดในการเชื่อมต่อกับเซิร์ฟเวอร์', 'danger');
                });
            }
        }

        function initializeTooltips() {
            // Initialize Bootstrap tooltips for management buttons
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const container = document.querySelector('.container-fluid');
            container.insertBefore(alertDiv, container.firstChild);
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        function logout() {
            if (confirm('คุณต้องการออกจากระบบหรือไม่?')) {
                window.location.href = '/auth/logout';
            }
        }

        // Utility function for debouncing
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>