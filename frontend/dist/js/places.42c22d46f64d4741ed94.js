(()=>{"use strict";const t="http://localhost:3000";class e{constructor(e=t){this.baseURL=e}async request(t,e={}){const a=`${this.baseURL}${t}`,n={headers:{"Content-Type":"application/json",...e.headers},...e};try{console.log(`üîÑ API Request: ${n.method||"GET"} ${a}`);const t=await fetch(a,n),e=await t.json();if(!t.ok)throw new Error(e.message||`HTTP error! status: ${t.status}`);return console.log(`‚úÖ API Response: ${a}`,e),e}catch(t){throw console.error(`‚ùå API Error: ${a}`,t),t}}async get(t){return this.request(t,{method:"GET"})}async post(t,e){return this.request(t,{method:"POST",body:JSON.stringify(e)})}}const a=new e;window.ApiClient=e,window.API_BASE_URL=t;class n{static currentLanguage="th";static supportedLanguages=["th","en","zh","ja"];static getCurrentLanguage(){return this.currentLanguage||localStorage.getItem("language")||"th"}static setLanguage(t){return!!this.supportedLanguages.includes(t)&&(this.currentLanguage=t,localStorage.setItem("language",t),window.dispatchEvent(new CustomEvent("languageChange",{detail:{language:t}})),!0)}static translate(t,e=null){return t?"string"==typeof t?t:t[e||this.getCurrentLanguage()]||t.th||t.en||"":""}static init(){const t=localStorage.getItem("language");t&&this.supportedLanguages.includes(t)&&(this.currentLanguage=t)}}n.init();class s{static showLoading(t){const e=document.getElementById(t);e&&(e.innerHTML='\n                <div class="text-center py-5">\n                    <div class="spinner-border text-primary" role="status">\n                        <span class="visually-hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>\n                    </div>\n                    <div class="mt-2 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>\n                </div>\n            ')}static showEmpty(t,e="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"){const a=document.getElementById(t);a&&(a.innerHTML=`\n                <div class="text-center py-5 text-muted">\n                    <i class="fas fa-inbox fa-3x mb-3"></i>\n                    <p>${e}</p>\n                </div>\n            `)}static showError(t,e="‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î"){const a=document.getElementById(t);a&&(a.innerHTML=`\n                <div class="text-center py-5 text-danger">\n                    <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>\n                    <p>${e}</p>\n                </div>\n            `)}static truncateText(t,e=100){return t?t.length<=e?t:t.substring(0,e)+"...":""}static generateStars(t){const e=Math.floor(t),a=t%1>=.5,n=5-e-(a?1:0);let s="";for(let t=0;t<e;t++)s+='<i class="fas fa-star text-warning"></i>';a&&(s+='<i class="fas fa-star-half-alt text-warning"></i>');for(let t=0;t<n;t++)s+='<i class="far fa-star text-muted"></i>';return s}static getImageUrl(t){return t?t.startsWith("http")?t:`http://localhost:3000/uploads/${t}`:"https://via.placeholder.com/400x250?text=No+Image"}static formatDate(t){return new Date(t).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"})}static formatTime(t){return t?t.substring(0,5):""}static showToast(t,e="success"){document.querySelectorAll(".toast-notification").forEach(t=>t.remove());const a=document.createElement("div");a.className=`toast-notification alert alert-${e} position-fixed`,a.style.cssText="top: 20px; right: 20px; z-index: 10000; min-width: 300px;",a.innerHTML=`\n            <div class="d-flex align-items-center">\n                <i class="fas ${this.getToastIcon(e)} me-2"></i>\n                <span>${t}</span>\n                <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>\n            </div>\n        `,document.body.appendChild(a),setTimeout(()=>{a.parentElement&&a.remove()},5e3)}static getToastIcon(t){const e={success:"fa-check-circle",error:"fa-exclamation-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"};return e[t]||e.info}static debounce(t,e){let a;return function(...n){clearTimeout(a),a=setTimeout(()=>{clearTimeout(a),t(...n)},e)}}static getUrlParams(){const t=new URLSearchParams(window.location.search),e={};for(const[a,n]of t)e[a]=n;return e}static updateUrl(t,e=!1){const a=new URL(window.location);Object.keys(t).forEach(e=>{null!==t[e]&&void 0!==t[e]?a.searchParams.set(e,t[e]):a.searchParams.delete(e)}),e?window.history.replaceState({},"",a):window.history.pushState({},"",a)}}class c{static async getPlaces(t={}){try{const e=new URLSearchParams(t).toString(),n="/api/public/places"+(e?`?${e}`:"");return await a.request(n)}catch(t){throw console.error("Error getting places:",t),t}}static async getPlace(t){try{return await a.request(`/api/public/places/${t}`)}catch(t){throw console.error("Error getting place:",t),t}}static async getFeaturedPlaces(t=6){try{return await this.getPlaces({featured:!0,limit:t,status:"published"})}catch(t){throw console.error("Error getting featured places:",t),t}}static async searchPlaces(t,e={}){try{return await this.getPlaces({search:t,...e})}catch(t){throw console.error("Error searching places:",t),t}}static async getPlacesByCategory(t,e={}){try{return await this.getPlaces({category:t,...e})}catch(t){throw console.error("Error getting places by category:",t),t}}}class r{static async getCategories(){try{return await a.request("/api/public/categories")}catch(t){throw console.error("Error getting categories:",t),t}}static async getCategory(t){try{return await a.request(`/api/public/categories/${t}`)}catch(t){throw console.error("Error getting category:",t),t}}static async getCategoryBySlug(t){try{const e=await this.getCategories();return e.success?{success:!0,data:e.data.find(e=>e.slug===t||e.id===t)||null}:e}catch(t){throw console.error("Error getting category by slug:",t),t}}}async function o(){const t=l();await g(t),u(t)}async function i(t){const e=t.target.value.trim(),a=l();e?a.search=e:delete a.search,await g(a),u(a)}function l(){const t={},e=s.getUrlParams();Object.assign(t,e);const a=document.getElementById("categoryFilter");a&&a.value&&(t.category=a.value);const n=document.getElementById("sortFilter");if(n&&n.value){const[e,a]=n.value.split("_");t.sortBy=e,t.sortOrder=a}const c=document.getElementById("searchInput");return c&&c.value.trim()&&(t.search=c.value.trim()),t}async function g(t={}){const e=document.getElementById("placesContainer"),a=document.getElementById("resultsInfo");s.showLoading("placesContainer");try{const r=await c.getPlaces({limit:12,...t});if(r.success&&r.data.length>0){if(e.innerHTML=r.data.map(t=>function(t){const e=n.translate(t.name),a=s.truncateText(n.translate(t.description),120),c=t.images&&t.images.length>0?s.getImageUrl(t.images[0]):"https://via.placeholder.com/400x250?text=No+Image",r=t.rating||0,o=t.priceRange||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏";return`\n        <div class="col-lg-4 col-md-6 mb-4">\n            <div class="place-card" onclick="goToPlaceDetail('${t.id}')">\n                <div class="place-image">\n                    <img src="${c}" alt="${e}" loading="lazy"\n                         onerror="this.src='https://via.placeholder.com/400x250?text=No+Image'">\n                    ${t.featured?'<div class="place-badge"><span class="badge bg-warning">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span></div>':""}\n                </div>\n                <div class="place-content">\n                    <h5 class="place-title">${e}</h5>\n                    <p class="place-description">${a}</p>\n                    <div class="place-meta">\n                        <div class="place-rating">\n                            ${s.generateStars(r)}\n                            <span class="ms-1">${r.toFixed(1)}</span>\n                        </div>\n                        <div class="place-price">${o}</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `}(t)).join(""),a){const t=r.pagination?.total||r.data.length;a.textContent=`‡∏û‡∏ö ${t} ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà`}r.pagination&&function(t){const e=document.getElementById("paginationContainer");if(!e||!t)return;const{current:a,total:n,hasNext:s,hasPrev:c}=t;let r='<nav><ul class="pagination justify-content-center">';r+=`\n        <li class="page-item ${c?"":"disabled"}">\n            <button class="page-link" onclick="changePage(${a-1})" ${c?"":"disabled"}>\n                <i class="fas fa-chevron-left"></i>\n            </button>\n        </li>\n    `;const o=Math.max(1,a-2),i=Math.min(n,a+2);o>1&&(r+='<li class="page-item"><button class="page-link" onclick="changePage(1)">1</button></li>',o>2&&(r+='<li class="page-item disabled"><span class="page-link">...</span></li>'));for(let t=o;t<=i;t++)r+=`\n            <li class="page-item ${t===a?"active":""}">\n                <button class="page-link" onclick="changePage(${t})">${t}</button>\n            </li>\n        `;i<n&&(i<n-1&&(r+='<li class="page-item disabled"><span class="page-link">...</span></li>'),r+=`<li class="page-item"><button class="page-link" onclick="changePage(${n})">${n}</button></li>`),r+=`\n        <li class="page-item ${s?"":"disabled"}">\n            <button class="page-link" onclick="changePage(${a+1})" ${s?"":"disabled"}>\n                <i class="fas fa-chevron-right"></i>\n            </button>\n        </li>\n    `,r+="</ul></nav>",e.innerHTML=r}(r.pagination)}else s.showEmpty("placesContainer","‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç"),a&&(a.textContent="‡∏û‡∏ö 0 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà")}catch(t){console.error("Error loading places:",t),s.showError("placesContainer","‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ")}}function u(t){s.updateUrl(t,!0)}document.addEventListener("DOMContentLoaded",function(){console.log("üó∫Ô∏è Places page loaded with Webpack"),async function(){try{!function(){const t=document.getElementById("categoryFilter"),e=document.getElementById("sortFilter");t&&t.addEventListener("change",o),e&&e.addEventListener("change",o)}(),function(){const t=document.getElementById("searchInput");t&&t.addEventListener("input",s.debounce(i,300))}(),await g(),await async function(){const t=document.getElementById("categoryFilter");if(t)try{const e=await r.getCategories();if(e.success){const a=t.querySelector('option[value=""]');t.innerHTML="",a&&t.appendChild(a),e.data.forEach(e=>{const a=document.createElement("option");a.value=e.id,a.textContent=n.translate(e.name),t.appendChild(a)});const c=s.getUrlParams();c.category&&(t.value=c.category)}}catch(t){console.error("Error loading categories for filter:",t)}}()}catch(t){console.error("Error initializing places page:",t),s.showError("placesContainer","‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ")}}()}),window.changePage=async function(t){const e=l();e.page=t,await g(e),u(e),window.scrollTo({top:0,behavior:"smooth"})},window.goToPlaceDetail=function(t){window.location.href=`detail.html?id=${t}`},window.addEventListener("load",()=>{const t=s.getUrlParams();Object.keys(t).forEach(e=>{const a=document.getElementById(e+"Filter")||document.getElementById(e);(a&&"select"===a.tagName.toLowerCase()||a&&"text"===a.type)&&(a.value=t[e])})})})();
//# sourceMappingURL=places.42c22d46f64d4741ed94.js.map